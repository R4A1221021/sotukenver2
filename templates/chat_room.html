{% extends "layout.html" %}

{% block title %}チャット - {{ chat_title }}{% endblock %}
{% block header_title %}{{ chat_title }}{% endblock %}

{% block content %}
    <div class="flex flex-col h-[75vh]">

        <div id="chat-log" class="flex-1 bg-white p-4 rounded-t-xl shadow-inner mb-4 overflow-y-auto space-y-4">

            {% for msg in messages %}
                <div class="text-sm {% if msg.user_id == current_user_id %}text-right{% endif %}">
                    <p class="font-bold text-xs text-gray-500">{{ msg.user_id }}</p>

                    <p class="{% if msg.user_id == current_user_id %}bg-blue-500 text-white{% else %}bg-gray-200{% endif %} p-3 rounded-t-xl {% if msg.user_id == current_user_id %}rounded-bl-xl{% else %}rounded-br-xl{% endif %} inline-block max-w-xs text-left">
                        {{ msg.text }}
                    </p>
                    <p class="text-xs text-gray-400 mt-1">{{ msg.timestamp }}</p>
                </div>
            {% else %}
                <p class="text-center text-gray-500">まだメッセージはありません。</p>
            {% endfor %}

        </div>

        <form id="chat-form" class="flex" method="POST" action="{{ post_url }}">
            <input type="text" id="chat-message-input" name="message_text"
                   class="flex-1 p-3 border border-gray-300 rounded-l-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="メッセージを入力..." required>
            <button type="submit" id="chat-message-submit"
                    class="bg-blue-600 text-white p-3 rounded-r-xl hover:bg-blue-700 font-semibold">送信
            </button>
        </form>

        <div class="mt-4 text-center">
            <a href="{{ url_for('chat') }}" class="text-gray-500 hover:text-blue-500 transition-colors">
                チャット選択に戻る
            </a>
        </div>
    </div>
{% endblock %}